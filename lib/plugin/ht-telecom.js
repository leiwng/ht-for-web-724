!function(h,G){"use strict";var n=ht.AlarmSeverity=function(n,J,K,P,b){this.value=n,this.name=J,this.nickName=K,this.color=P,this.displayName=b};ht.Default.def("ht.AlarmSeverity",G,{toString:function(){return this.displayName||this.name}}),function(){n.severities=new ht.List,n._vm={},n._nm={},n._cp=function(M,X){if(M&&X){var o=M.value-X.value;return o>0?1:0>o?-1:0}return M&&!X?1:!M&&X?-1:0},n.each=function(B,$){n.severities.each(B,$)},n.getSortFunction=function(){return n._cp},n.setSortFunction=function(e){n._cp=e,n.severities.sort(e)},n.add=function(y,Z,I,h,J){var $=new n(y,Z,I,h,J);return n._vm[y]=$,n._nm[Z]=$,n.severities.add($),n.severities.sort(n._cp),$},n.remove=function(_){var r=n._nm[_];return r&&(delete n._nm[_],delete n._vm[r.value],n.severities.remove(r)),r},n.CRITICAL=n.add(500,"Critical","C","#FF0000"),n.MAJOR=n.add(400,"Major","M","#FFA000"),n.MINOR=n.add(300,"Minor","m","#FFFF00"),n.WARNING=n.add(200,"Warning","W","#00FFFF"),n.INDETERMINATE=n.add(100,"Indeterminate","N","#C800FF"),n.CLEARED=n.add(0,"Cleared","R","#00FF00"),n.isClearedAlarmSeverity=function(u){return u?0===u.value:!1},n.getByName=function($){return n._nm[$]},n.getByValue=function(J){return n._vm[J]},n.clear=function(){n.severities.clear(),n._vm={},n._nm={}},n.compare=function(m,S){return n._cp(m,S)}}();var O=ht.AlarmState=function(A){this._d=A,this._nm={},this._am={},this._ps=null,this._haa=null,this._hna=null,this._hoa=null,this._hta=null,this._hls=!1,this._aac=0,this._nac=0};ht.Default.def("ht.AlarmState",G,{_ep:!0,_f:function(){this._c1(),this._c2(),this._c3(),this._c4(),this._c5(),this._c6(),this._c7(),this._d.fp("alarmState",null,this)},getHighestAcknowledgedAlarmSeverity:function(){return this._haa},getHighestNewAlarmSeverity:function(){return this._hna},getHighestOverallAlarmSeverity:function(){return this._hoa},getHighestNativeAlarmSeverity:function(){return this._hta},hasLessSevereNewAlarms:function(){return this._hls},_c1:function(){var N=null;for(var z in this._am)z=n.getByName(z),n.isClearedAlarmSeverity(z)||0!==this.getAcknowledgedAlarmCount(z)&&(N=N?n.compare(N,z)>0?N:z:z);this._haa=N},_c2:function(){var G=null;for(var w in this._nm)w=n.getByName(w),n.isClearedAlarmSeverity(w)||0!==this.getNewAlarmCount(w)&&(G=G?n.compare(G,w)>0?G:w:w);this._hna=G},_c3:function(){if(!this._hna)return this._hls=!1,void 0;for(var I in this._nm)if(I=n.getByName(I),!n.isClearedAlarmSeverity(I)&&0!==this.getNewAlarmCount(I)&&n.compare(this._hna,I)>0)return this._hls=!0,void 0;this._hls=!1},_c4:function(){var b=this._haa,N=this._hna,T=this._ps;this._hoa=b,n.compare(N,this._hoa)>0&&(this._hoa=N),n.compare(T,this._hoa)>0&&(this._hoa=T)},_c5:function(){var c=this._haa,N=this._hna;this._hta=c,n.compare(N,this._hta)>0&&(this._hta=N)},increaseAcknowledgedAlarm:function(P,G){if(0!==G){G=G||1;var N=this._am[P.name]||0;N+=G,this._am[P.name]=N,this._f()}},increaseNewAlarm:function(P,k){if(0!==k){k=k||1;var d=this._nm[P.name]||0;d+=k,this._nm[P.name]=d,this._f()}},decreaseAcknowledgedAlarm:function(s,q){if(0!==q){q||(q=1);var _=this._am[s.name]||0;if(_-=q,0>_)throw"Alarm count can not be negative";this._am[s.name]=_,this._f()}},decreaseNewAlarm:function(U,b){if(0!==b){b||(b=1);var M=this._nm[U.name]||0;if(M-=b,0>M)throw"Alarm count can not be negative";this._nm[U.name]=M,this._f()}},acknowledgeAlarm:function(x){this.decreaseNewAlarm(x,1),this.increaseAcknowledgedAlarm(x,1)},acknowledgeAllAlarms:function(i){if(i){var k=this.getNewAlarmCount(i);this.decreaseNewAlarm(i,k),this.increaseAcknowledgedAlarm(i,k)}else for(var I in this._nm)this.acknowledgeAllAlarms(n.getByName(I))},_c6:function(){this._aac=0;for(var $ in this._am)$=n.getByName($),this._aac+=this.getAcknowledgedAlarmCount($)},getAcknowledgedAlarmCount:function($){return $?this._am[$.name]||0:this._aac},getAlarmCount:function(j){return this.getAcknowledgedAlarmCount(j)+this.getNewAlarmCount(j)},_c7:function(){this._nac=0;for(var d in this._nm)this._nac+=this.getNewAlarmCount(n.getByName(d))},getNewAlarmCount:function(h){return h?this._nm[h.name]||0:this._nac},setNewAlarmCount:function(Y,x){this._nm[Y.name]=x,this._f()},removeAllNewAlarms:function(f){f?delete this._nm[f]:this._nm={},this._f()},setAcknowledgedAlarmCount:function(F,I){this._am[F.name]=I,this._f()},removeAllAcknowledgedAlarms:function(h){h?delete this._am[h.name]:this._am={},this._f()},isEmpty:function(){return!this._hoa},clear:function(){this._am={},this._nm={},this._f()},getPropagateSeverity:function(){return this._ps},setPropagateSeverity:function(N){if(this._ep||(N=null),this._ps!==N){var I=this._ps;this._ps=N,this._f(),this._d.fp("propagateSeverity",I,N)}},isEnablePropagation:function(){return this._ep},setEnablePropagation:function(W){var i=this._ep;this._ep=W,this._d.fp("enablePropagation",i,W)&&(W||this.setPropagateSeverity(null))}});var l=ht.AlarmStatePropagator=function(s){this._dataModel=s,this._enable=!1,this._isPropagating=!1};ht.Default.def("ht.AlarmStatePropagator",G,{getDataModel:function(){return this._dataModel},isEnable:function(){return this._enable},setEnable:function(p){this._enable!==p&&(this._enable=p,this._enable?(this._dataModel.mm(this.handleDataModelChange,this),this._dataModel.md(this.handleDataPropertyChange,this),this._dataModel.each(function(Y){this.propagate(Y)},this)):(this._dataModel.umm(this.handleDataModelChange,this),this._dataModel.umd(this.handleDataPropertyChange,this)))},handleDataModelChange:function(M){M.data&&this.propagate(M.data)},handleDataPropertyChange:function(p){if("alarmState"===p.property||"enablePropagation"===p.property)this.propagate(p.data);else if("parent"===p.property){var A=p.oldValue;A&&this.propagate(A),this.propagate(p.data)}},propagate:function(v){v&&!this._isPropagating&&(this._isPropagating=!0,this.propagateToTop(v),this._isPropagating=!1)},propagateToTop:function(U){for(this.propagateToParent(null,U);U&&U.getParent();)this.propagateToParent(U,U.getParent()),U=U.getParent()},propagateToParent:function(h,J){var I=null;J.getChildren().each(function(u){var M=u.getAlarmState().getHighestOverallAlarmSeverity();n.compare(M,I)>0&&(I=M)}),J.getAlarmState().setPropagateSeverity(I)}}),ht.AlarmStateStatistics=function(V){this.sumNew=0,this.sumAcked=0,this.sumTotal=0,this.severtiyMap={},this.dataMap={},this.setDataModel(V)},ht.Default.def("ht.AlarmStateStatistics",G,{ms_fire:1,getDataModel:function(){return this._dataModel},setDataModel:function(c){var f=this._dataModel;f!==c&&(f&&(f.umd(this.handleDataPropertyChange,this),f.umm(this.handleDataModelChange,this),this.severtiyMap={},this.dataMap={}),this._dataModel=c,this.reset(),c.md(this.handleDataPropertyChange,this),c.mm(this.handleDataModelChange,this),this.fp("dataModel",f,c))},dispose:function(){this._dataModel.umd(this.handleDataPropertyChange,this),this._dataModel.umm(this.handleDataModelChange,this),delete this._dataModel},handleDataPropertyChange:function(m){"alarmState"===m.property&&(this.increase(m.data),this.fireAlarmStateChange())},handleDataModelChange:function(v){"add"===v.kind?(this.increase(v.data),this.fireAlarmStateChange()):"remove"===v.kind?(this.decrease(v.data),this.fireAlarmStateChange()):"clear"===v.kind&&(this.severtiyMap={},this.dataMap={},this.fireAlarmStateChange())},fireAlarmStateChange:function(){this.sumAcked=0,this.sumNew=0,this.sumTotal=0,n.each(function(C){var k=this.getSumInfo(C);this.sumAcked+=k.ackedCount,this.sumNew+=k.newCount,this.sumTotal+=k.totalCount},this),this.fp("alarmState",!1,!0)},getNewAlarmCount:function(U){if(!U)return this.sumNew;var M=this.getSumInfo(U);return M.newCount},getAcknowledgedAlarmCount:function(e){if(!e)return this.sumAcked;var D=this.getSumInfo(e);return D.ackedCount},getTotalAlarmCount:function(s){if(!s)return this.sumTotal;var G=this.getSumInfo(s);return G.totalCount},getSumInfo:function(m){var t=this.severtiyMap[m.name];return t||(t={},t.newCount=0,t.ackedCount=0,t.totalCount=0,this.severtiyMap[m.name]=t),t},decrease:function(U){var M=this.dataMap[U.getId()];M&&(delete this.dataMap[U.getId()],n.each(function(B){var T=M[B.name],F=this.getSumInfo(B);F.newCount=F.newCount-T.newCount,F.ackedCount=F.ackedCount-T.ackedCount,F.totalCount=F.totalCount-T.totalCount},this))},increase:function(Z){if(this.decrease(Z),!this._filterFunc||this._filterFunc(Z)){var j={},Y=Z.getAlarmState();this.dataMap[Z.getId()]=j,n.each(function(w){var O={};O.newCount=Y.getNewAlarmCount(w),O.ackedCount=Y.getAcknowledgedAlarmCount(w),O.totalCount=Y.getAlarmCount(w),j[w.name]=O;var J=this.getSumInfo(w);J.newCount=J.newCount+O.newCount,J.ackedCount=J.ackedCount+O.ackedCount,J.totalCount=J.totalCount+O.totalCount},this)}},reset:function(){this.severtiyMap={},this.dataMap={},this._dataModel.each(this.increase,this),this.fireAlarmStateChange()},setFilterFunc:function(j){var S=this._filterFunc;this._filterFunc=j,this.reset(),this.fp("filterFunc",S,j)},getFilterFunc:function(){return this._filterFunc}});var a=ht.Data.prototype;a.getAlarmState=function(){return this._alarmState||(this._alarmState=new O(this))},a=ht.DataModel.prototype,a.isEnableAlarmStatePropagator=function(){return!!this._alarmStatePropagator&&this._alarmStatePropagator.isEnable()},a.setEnableAlarmStatePropagator=function(O){O!=this.isEnableAlarmStatePropagator()&&(O?(this._alarmStatePropagator=new l(this)).setEnable(!0):this._alarmStatePropagator.setEnable(!1))},a=ht.graph.GraphView.prototype,a.getNote2=function(U){var S=U.getAlarmState().getHighestNewAlarmSeverity();if(S){var O=U.getAlarmState().getNewAlarmCount(S)+S.nickName;return U.getAlarmState().hasLessSevereNewAlarms()&&(O+="+"),O}return U.s("note2")},a.getNote2Background=function(Y){var A=Y.getAlarmState().getHighestNewAlarmSeverity();return A?A.color:Y.s("note2.background")},a.getBodyColor=function(z){var i=z.getAlarmState().getHighestNativeAlarmSeverity();return i?i.color:z.s("body.color")},a.getBorderColor=function(o){var R=o.getAlarmState().getPropagateSeverity();return R?R.color:o.s("border.color")},a=ht.widget.TreeView.prototype,a.getBorderColor=function(Z){var t=Z.getAlarmState().getPropagateSeverity();return t?t.color:Z.s("border.color")},a.getIcon=function(o){return o.getIcon()?"__alarmIcon__":null},a=ht.widget.TreeTableView.prototype,a.getBorderColor=function(N){var p=N.getAlarmState().getPropagateSeverity();return p?p.color:N.s("border.color")},a.getIcon=function(M){return M.getIcon()?"__alarmIcon__":null},ht.Default.setImage("__alarmIcon__",{width:16,height:16,comps:[{type:"image",name:{func:function(D){return D.getIcon()}},color:{func:function(g){var b=g.getAlarmState().getHighestNativeAlarmSeverity();return b?b.color:g.s("body.color")}},rect:[0,0,16,16]}]});var f=ht.Style;f["note2.expanded"]=!0,f["note2.color"]="#000"}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);