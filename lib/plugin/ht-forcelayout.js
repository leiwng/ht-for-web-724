!function(d,X){"use strict";var Z="ht",G=Z+".layout.",g=d[Z]||module.parent.exports.ht,L=g.List,a=g.DataModel,D=g.Node,i=g.Edge,m=g.Group,P=Math,Q=P.sqrt,h=P.random,s=P.max,O=P.min,w=function(S){return S*S};g.Default.getInternal().addMSMap({ms_force:function(w){w._interval=50,w._stepCount=10,w._motionLimit=.01,w._edgeRepulsion=.65,w._nodeRepulsion=.65,w._damper=1,w._maxMotion=0,w._motionRatio=0,w.init=function(d){var M=this;d instanceof a?M.dm=d:M.gv=d,M._nodeMap={},M._nodes=new L,M._edges=new L},w.start=function(){var p=this,o=p.gv;if(!p._timer){var L=p.cdm=o?o.dm():p.dm;L.mm(p.handleDataModelChange,p),L.md(p.handleDataPropertyChange,p),o&&o.mp(p.handleGV,p),L.each(function(Y){if(p.isVisible(Y)&&p.isLayoutable(Y)&&Y instanceof D)if(p instanceof l){var T=Y.p3();Y.p3([T[0]+h(),T[1]+h(),T[2]+h()])}else T=Y.p(),Y.p(T.x+h(),T.y+h())}),p._timer=setInterval(function(){p.relax()},p._interval),p._damper=1}},w.stop=function(){var I=this;I._timer&&(I.cdm.umm(I.handleDataModelChange,I),I.cdm.umd(I.handleDataPropertyChange,I),I.gv&&I.gv.ump(I.handleGV,I),clearInterval(I._timer),delete I._timer,delete I.cdm)},w.handleGV=function(U){var h=this;if("dataModel"===U.property){var r=U.oldValue,E=U.newValue;r&&(r.umm(h.handleDataModelChange,h),r.umd(h.handleDataPropertyChange,h)),this.cdm=E,E.mm(h.handleDataModelChange,h),E.md(h.handleDataPropertyChange,h)}},w.relax=function(){var Q=this;if(!(Q._damper<.1&&Q._maxMotion<Q._motionLimit)){this.cdm.each(function(A){Q.isVisible(A)&&(A instanceof i?Q.addEdge(A):A instanceof D&&Q.addNode(A))});for(var f,u,O=0,J=Q._edges,c=Q._nodes,l=c.size();O<Q._stepCount;O++){for(J.each(Q.relaxEdge,Q),f=0;l>f;f++)for(u=0;l>u;u++)Q.relaxNode(c.get(f),c.get(u));Q.moveNode()}Q._isAdjusting=1,c.each(function(A){A.fix||(A.p?A.v.p3(A.p):A.v.p(A.x,A.y))}),delete Q._isAdjusting,Q._nodeMap={},c.clear(),J.clear(),Q.onRelaxed()}},w.onRelaxed=function(){},w.isRunning=function(){return!!this._timer},w.isVisible=function(O){return O.s("layoutable")===!1?!1:this.gv?this.gv.isVisible(O):!0},w.isLayoutable=function(M){if(M.s("layoutable")===!1)return!1;if(M instanceof m)return!1;var L=this;return L.gv?L.gv.isMovable(M)&&!L.gv.isSelected(M):!(L.cdm||L.dm).sm().co(M)},w.getNodeRepulsion=function(){return this._nodeRepulsion},w.setNodeRepulsion=function(y){this._nodeRepulsion=y,this._damper=1},w.getEdgeRepulsion=function(){return this._edgeRepulsion},w.setEdgeRepulsion=function(Z){this._edgeRepulsion=Z,this._damper=1},w.getStepCount=function(){return this._stepCount},w.setStepCount=function(P){this._stepCount=P,this._damper=1},w.getInterval=function(){return this._interval},w.setInterval=function(V){var y=this;y._interval!==V&&(y._interval=V,y._timer&&(clearInterval(y._timer),y._timer=setInterval(function(){y.relax()},V)))},w.handleDataPropertyChange=function(H){!this._isAdjusting&&this.isVisible(H.data)&&(this._damper=1)},w.handleDataModelChange=function(){this._damper=1},w.damp=function(){var d=this._maxMotion,Z=this._damper;this._motionRatio<=.001&&((.2>d||d>1&&.9>Z)&&Z>.01?this._damper-=.01:.4>d&&Z>.003?this._damper-=.003:Z>1e-4&&(this._damper-=1e-4)),d<this._motionLimit&&(this._damper=0)}}}),g.layout.ForceLayout=function(n){this.init(n)},g.Default.def(G+"ForceLayout",X,{ms_force:1,getLimitBounds:function(){return this._limitBounds},setLimitBounds:function(y){this._limitBounds=y,this._damper=1},getNodeSize:function(E){var T=this.gv;return T&&T.getDataUIBounds?T.getDataUIBounds(E):E.getRect()},addNode:function(u){var x=this,L=x._nodeMap[u._id];if(L)return L;var o=u.p();L={v:u,x:o.x,y:o.y,dx:0,dy:0,fix:!x.isLayoutable(u),s:x.getNodeSize(u)};var A=L.s,Y=Q(w(A.width)+w(A.height))*x._nodeRepulsion;return L.r=1>Y?100:Y,x._nodeMap[u._id]=L,x._nodes.add(L),L},addEdge:function(W){if(W._40I&&W._41I){var f=this,V=f.addNode(W._40I),D=f.addNode(W._41I),$={s:V,t:D};D=D.s,V=V.s;var d=D.width+V.width,o=D.height+V.height;$.length=Q(d*d+o*o)*f._edgeRepulsion,$.length<=0&&($.length=100),f._edges.add($)}},relaxEdge:function(i){var U=i.t,b=i.s,P=U.x-b.x,C=U.y-b.y,J=Q(P*P+C*C),t=100*i.length,q=.25*P/t*J,S=.25*C/t*J;U.dx=U.dx-q,U.dy=U.dy-S,b.dx=b.dx+q,b.dy=b.dy+S},relaxNode:function(j,O){if(j!==O){var X=0,T=0,V=j.x-O.x,_=j.y-O.y,e=V*V+_*_;0===e?(X=h(),T=h()):36e4>e&&(X=V/e,T=_/e);var o=j.r*O.r/400;X*=o,T*=o,j.dx+=X,j.dy+=T,O.dx-=X,O.dy-=T}},moveNode:function(){var h=this,L=h._limitBounds,N=h._maxMotion,E=0,V=h._damper;h._nodes.each(function(J){if(!J.fix){var e=J.dx*V,o=J.dy*V;if(J.dx=e/2,J.dy=o/2,E=s(Q(e*e+o*o),E),J.x+=s(-40,O(40,e)),J.y+=s(-40,O(40,o)),L){J.x<L.x&&(J.x=L.x,h.adjust(1,0)),J.y<L.y&&(J.y=L.y,h.adjust(0,1));var n=J.s;J.x+n.width>L.x+L.width&&(J.x=L.x+L.width-n.width,h.adjust(-1,0)),J.y+n.height>L.y+L.height&&(J.y=L.y+L.height-n.height,h.adjust(0,-1))}}}),h._maxMotion=E,h._motionRatio=E>0?N/E-1:0,h.damp()},adjust:function(Q,N){var O=this._limitBounds;this._nodes.each(function($){Q>0?(!O||$.x+$.s.width+Q<O.x+O.width)&&($.x+=Q):(!O||$.x+Q>O.x)&&($.x+=Q),N>0?(!O||$.y+$.s.height+N<O.y+O.height)&&($.y+=N):(!O||$.y+N>O.y)&&($.y+=N)})}});var l=g.layout.Force3dLayout=function(p){this.init(p)};g.Default.def(G+"Force3dLayout",X,{ms_force:1,getNodeSize3d:function(j){return j.s3()},addNode:function(y){var Q=this,f=Q._nodeMap[y._id];if(f)return f;f={v:y,p:y.p3(),d:[0,0,0],fix:!Q.isLayoutable(y),s:Q.getNodeSize3d(y)};var m=f.s,X=g.Default.getDistance(m)*Q._nodeRepulsion;return f.r=1>X?100:X,Q._nodeMap[y._id]=f,Q._nodes.add(f),f},addEdge:function(P){if(P._40I&&P._41I){var u=this,N=u.addNode(P._40I),K=u.addNode(P._41I),I={s:N,t:K};K=K.s,N=N.s,I.length=Q(w(K[0]+N[0])+w(K[1]+N[1])+w(K[2]+N[2]))*u._edgeRepulsion,I.length<=0&&(I.length=100),u._edges.add(I)}},relaxEdge:function(e){var s=e.t.p,H=e.s.p,I=e.t.d,X=e.s.d,L=s[0]-H[0],U=s[1]-H[1],d=s[2]-H[2],T=Q(L*L+U*U+d*d),t=100*e.length,Z=.25*L/t*T,S=.25*U/t*T,A=.25*d/t*T;I[0]-=Z,I[1]-=S,I[2]-=A,X[0]+=Z,X[1]+=S,X[2]+=A},relaxNode:function(r,A){if(r!==A){var J=r.p,U=A.p,g=0,P=0,q=0,c=J[0]-U[0],_=J[1]-U[1],T=J[2]-U[2],e=c*c+_*_+T*T;0===e?(g=h(),P=h(),q=h()):216e6>e&&(g=c/e,P=_/e,q=T/e);var x=r.r*A.r/400,Q=r.d,j=A.d;g*=x,P*=x,q*=x,Q[0]+=g,Q[1]+=P,Q[2]+=q,j[0]-=g,j[1]-=P,j[2]-=q}},moveNode:function(){var u=this,M=u._maxMotion,m=0,v=u._damper;u._nodes.each(function(Z){if(!Z.fix){var o=Z.p,z=Z.d,j=z[0]*v,M=z[1]*v,Y=z[2]*v;z[0]=j/2,z[1]=M/2,z[2]=Y/2,m=s(Q(j*j+M*M+Y*Y),m),o[0]+=s(-40,O(40,j)),o[1]+=s(-40,O(40,M)),o[2]+=s(-40,O(40,Y))}}),u._maxMotion=m,u._motionRatio=m>0?M/m-1:0,u.damp()}})}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);